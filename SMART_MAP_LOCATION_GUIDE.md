# ๐ฏ ุฏููู ุงููููุน ุงูุฐูู ููุฎุฑูุทุฉ - Smart Map Location Guide

## โจ ุงูููุฒุฉ ุงูุฌุฏูุฏุฉ

ุนูุฏ ูุชุญ ุตูุญุฉ ุงููุฑุงูุจุฉุ ุชุจุฏุฃ ุงูุฎุฑูุทุฉ ุชููุงุฆูุงู ูู **ุฃูุถู ูููุน ูููู**:

### ๐ ุงุณุชุฑุงุชูุฌูุฉ ุงููููุน ุงูุฐูู:

```
1๏ธโฃ ุงูุฃููููุฉ ุงูุฃููู: ูุฑูุฒ ุชุฌูุน ุงูุฑุญูุงุช ุงููุดุทุฉ
   โ (ุฅุฐุง ูุดู)
2๏ธโฃ ุงูุฃููููุฉ ุงูุซุงููุฉ: ูููุน ุงูุดุฑูุฉ
```

---

## ๐ ููู ูุนููุ

### ุนูุฏ ูุฌูุฏ ุฑุญูุงุช ูุดุทุฉ:
```dart
// ูุญุณุจ ุงููุฑูุฒ ุงูุฌุบุฑุงูู ูุฌููุน ุงูุฑุญูุงุช (Center of Mass)
Center Latitude = (Trip1_Lat + Trip2_Lat + ... + TripN_Lat) / N
Center Longitude = (Trip1_Lng + Trip2_Lng + ... + TripN_Lng) / N

// ุงูุฎุฑูุทุฉ ุชุจุฏุฃ ูู ูุฐุง ุงููุฑูุฒ ุจูุณุชูู ุชูุจูุฑ ููุงุณุจ
```

### ุนูุฏ ุนุฏู ูุฌูุฏ ุฑุญูุงุช:
```dart
// ุชุณุชุฎุฏู ูููุน ุงูุดุฑูุฉ ูู CompanyConfig
initialLocation = CompanyConfig.defaultLocation
```

---

## โ๏ธ ุงูุชุฎุตูุต: ุชุบููุฑ ูููุน ุงูุดุฑูุฉ

### ๐ ุงูููู: `lib/core/config/company_config.dart`

```dart
class CompanyConfig {
  /// ๐ข ูููุน ุงูุดุฑูุฉ ุงูุงูุชุฑุงุถู
  static const defaultLocation = MapLocation(
    latitude: 35.7595,  // ุบููุฑ ูุฐุง ุงูุฑูู
    longitude: -5.8340, // ููุฐุง ุงูุฑูู
  );

  /// ๐ ุงุณู ุงููุฏููุฉ
  static const String cityName = 'ุทูุฌุฉ'; // ุบููุฑ ุงูุงุณู

  // ุจุงูู ุงูุฅุนุฏุงุฏุงุช...
}
```

### ๐บ๏ธ ุฃูุซูุฉ ููุฏู ูุบุฑุจูุฉ:

| ุงููุฏููุฉ | Latitude | Longitude |
|---------|----------|-----------|
| **ุทูุฌุฉ** | 35.7595 | -5.8340 |
| **ุงูุฑุจุงุท** | 33.9716 | -6.8498 |
| **ุงูุฏุงุฑ ุงูุจูุถุงุก** | 33.5731 | -7.5898 |
| **ูุฑุงูุด** | 31.6295 | -7.9811 |
| **ูุงุณ** | 34.0181 | -5.0078 |
| **ุฃูุงุฏูุฑ** | 30.4278 | -9.5981 |
| **ูุฌุฏุฉ** | 34.6814 | -1.9086 |
| **ุงููููุทุฑุฉ** | 34.2610 | -6.5802 |

### ูุซุงู: ุชุบููุฑ ุงููููุน ุฅูู ุงูุฏุงุฑ ุงูุจูุถุงุก

```dart
// ูู lib/core/config/company_config.dart
static const defaultLocation = MapLocation(
  latitude: 33.5731,  // ุงูุฏุงุฑ ุงูุจูุถุงุก
  longitude: -7.5898,
);

static const String cityName = 'ุงูุฏุงุฑ ุงูุจูุถุงุก';
```

---

## ๐ฎ ูุณุชููุงุช ุงูุชูุจูุฑ

ููููู ุชุฎุตูุต ูุณุชููุงุช ุงูุชูุจูุฑ ูู `CompanyConfig`:

```dart
class CompanyConfig {
  /// ๐ ูุณุชูู ุงูุชูุจูุฑ ุนูุฏ ุนุฏู ูุฌูุฏ ุฑุญูุงุช
  static const double defaultZoom = 12.0;

  /// ๐ ูุณุชูู ุงูุชูุจูุฑ ุนูุฏ ูุฌูุฏ ุฑุญูุงุช ูุชุนุฏุฏุฉ
  static const double tripsZoom = 11.0;

  /// ๐ ูุณุชูู ุงูุชูุจูุฑ ุนูุฏ ุงูุชุฑููุฒ ุนูู ุฑุญูุฉ ูุงุญุฏุฉ
  static const double focusZoom = 15.0;

  /// ๐ฏ Padding ููุฎุฑูุทุฉ
  static const double mapPadding = 50.0;
}
```

### ูุณุชููุงุช ุงูุชูุจูุฑ (Zoom Levels):

| ุงููุณุชูู | ุงููุตู | ุงูุงุณุชุฎุฏุงู |
|---------|-------|-----------|
| 1-3 | ุนุฑุถ ุงูุนุงูู | ูุงุฏุฑุงู |
| 4-6 | ุนุฑุถ ุงูุฏูู | ูุงุฏุฑุงู |
| 7-10 | ุนุฑุถ ุงูููุงุทู | ููุงุทู ูุจูุฑุฉ |
| **11-13** | ุนุฑุถ ุงููุฏู | **ุงูุชุฑุงุถู ููุดุฑูุฉ** |
| **14-16** | ุนุฑุถ ุงูุฃุญูุงุก | **ุฑุญูุฉ ูุงุญุฏุฉ** |
| 17-20 | ุนุฑุถ ุงูุดูุงุฑุน | ุชูุงุตูู ุฏูููุฉ |

---

## ๐ ุณููุงุฑูููุงุช ุงูุงุณุชุฎุฏุงู

### ๐ข ุณููุงุฑูู 1: ูุฌูุฏ 5 ุฑุญูุงุช ูุดุทุฉ

```
๐ ุงูุฑุญูุฉ 1: (35.7595, -5.8340) - ุทูุฌุฉ
๐ ุงูุฑุญูุฉ 2: (35.7500, -5.8400) - ูุฑุจ ุทูุฌุฉ
๐ ุงูุฑุญูุฉ 3: (35.7600, -5.8200) - ูุฑุจ ุทูุฌุฉ
๐ ุงูุฑุญูุฉ 4: (35.7700, -5.8350) - ูุฑุจ ุทูุฌุฉ
๐ ุงูุฑุญูุฉ 5: (35.7550, -5.8300) - ูุฑุจ ุทูุฌุฉ

โ ุงููุชูุฌุฉ:
ุงููุฑูุฒ ุงููุญุณูุจ: (35.7589, -5.8318)
ุงูุฎุฑูุทุฉ ุชุจุฏุฃ ูู ุงูููุชุตู ุชูุงูุงู ุจูู ุฌููุน ุงูุฑุญูุงุช
```

### ๐ด ุณููุงุฑูู 2: ูุง ุชูุฌุฏ ุฑุญูุงุช ูุดุทุฉ

```
โ ุนุฏุฏ ุงูุฑุญูุงุช: 0

โ ุงููุชูุฌุฉ:
ุงูุฎุฑูุทุฉ ุชุจุฏุฃ ูู ูููุน ุงูุดุฑูุฉ: ุทูุฌุฉ (35.7595, -5.8340)
ูุณุชูู ุงูุชูุจูุฑ: 12 (ุนุฑุถ ุงููุฏููุฉ)
```

### ๐ก ุณููุงุฑูู 3: ุฑุญูุงุช ุจุฏูู GPS

```
๐ ุงูุฑุญูุฉ 1: (0, 0) โ ูููุน ุบูุฑ ุตุงูุญ
๐ ุงูุฑุญูุฉ 2: (null, null) โ ุจุฏูู GPS
๐ ุงูุฑุญูุฉ 3: (35.7595, -5.8340) โ ูููุน ุตุงูุญ

โ ุงููุชูุฌุฉ:
ุชูุญุณุจ ุงูุฑุญูุฉ 3 ููุท (ุงูุตุงูุญุฉ)
ุงูุฎุฑูุทุฉ ุชุจุฏุฃ ูู ูููุน ุงูุฑุญูุฉ 3
```

---

## ๐ ุฑุคูุฉ ุชูููุฉ

### ุงูุชูููุฐ ูู ุงูููุฏ:

```dart
MapLocation _calculateSmartInitialLocation(List<Trip> trips) {
  // 1๏ธโฃ ุชุตููุฉ ุงูุฑุญูุงุช ุฐุงุช ุงูููุงูุน ุงูุตุญูุญุฉ
  final tripsWithLocation = trips
      .where((t) => _isValidLatLng(t.currentLatitude, t.currentLongitude))
      .toList();

  // 2๏ธโฃ ุฅุฐุง ูู ุชูุฌุฏ ุฑุญูุงุช ุตุงูุญุฉ
  if (tripsWithLocation.isEmpty) {
    return CompanyConfig.defaultLocation; // ูููุน ุงูุดุฑูุฉ
  }

  // 3๏ธโฃ ุญุณุงุจ ุงููุฑูุฒ ุงูุฌุบุฑุงูู
  double sumLat = 0;
  double sumLng = 0;

  for (final trip in tripsWithLocation) {
    sumLat += trip.currentLatitude!;
    sumLng += trip.currentLongitude!;
  }

  final centerLat = sumLat / tripsWithLocation.length;
  final centerLng = sumLng / tripsWithLocation.length;

  return MapLocation(
    latitude: centerLat,
    longitude: centerLng,
  );
}
```

### ูุนุงููุฑ ุงููููุน ุงูุตุงูุญ:

```dart
static bool _isValidLatLng(double? lat, double? lng) {
  if (lat == null || lng == null) return false;
  if (lat.isNaN || lng.isNaN) return false;
  if (!lat.isFinite || !lng.isFinite) return false;
  if (lat < -90 || lat > 90) return false;       // ูุทุงู ุฎุท ุงูุนุฑุถ
  if (lng < -180 || lng > 180) return false;     // ูุทุงู ุฎุท ุงูุทูู
  if (lat.abs() < 0.00001 && lng.abs() < 0.00001) return false; // (0,0)
  
  return true;
}
```

---

## ๐งช ุงุฎุชุจุงุฑ ุงูููุฒุฉ

### 1. ุงุฎุชุจุงุฑ ูุน ุฑุญูุงุช ูุดุทุฉ:
```bash
flutter run -d chrome
# ุงูุชุญ ุตูุญุฉ ุงููุฑุงูุจุฉ
# ุชููุน: ุงูุฎุฑูุทุฉ ุชุจุฏุฃ ูู ูุฑูุฒ ุงูุฑุญูุงุช
```

### 2. ุงุฎุชุจุงุฑ ุจุฏูู ุฑุญูุงุช:
```bash
# ุชุฃูุฏ ูู ุนุฏู ูุฌูุฏ ุฑุญูุงุช ูุดุทุฉ
flutter run -d chrome
# ุงูุชุญ ุตูุญุฉ ุงููุฑุงูุจุฉ
# ุชููุน: ุงูุฎุฑูุทุฉ ุชุจุฏุฃ ูู ูููุน ุงูุดุฑูุฉ (ุทูุฌุฉ)
```

### 3. ุนุฑุถ ุงูู Debug Log:
```dart
// ูู dispatcher_monitor_screen.dart
debugPrint('๐ [Monitor] Calculated center of ${tripsWithLocation.length} trips');
debugPrint('๐ [Monitor] No trips with valid location, using company location');
```

---

## ๐ ููุงุญุธุงุช ูููุฉ

### โ ุงููุฒุงูุง:
- ๐ฏ ุชุฌุฑุจุฉ ูุณุชุฎุฏู ุฃูุถู - ุงูุฎุฑูุทุฉ ุชุจุฏุฃ ูู ุงููููุน ุงูุตุญูุญ
- ๐ ูููุน ุฏููุงูููู - ูุชุบูุฑ ุญุณุจ ุงูุฑุญูุงุช ุงููุดุทุฉ
- ๐ข ูููุน ุงุญุชูุงุทู - ุฏุงุฆูุงู ููุงู ูููุน ุงูุชุฑุงุถู
- โ๏ธ ุณูู ุงูุชุฎุตูุต - ููู ุชูููู ูุงุญุฏ ููุท

### โ๏ธ ุชุญุฐูุฑุงุช:
- ุงููููุน ููุญุณุจ ูุฑุฉ ูุงุญุฏุฉ ุนูุฏ ูุชุญ ุงูุตูุญุฉ
- ุฅุฐุง ุชุญุฑูุช ุงูุฑุญูุงุช ุจุนุฏ ุงููุชุญุ ุงููููุน ุงูุงุจุชุฏุงุฆู ูุง ูุชุบูุฑ
- ููู ุงูู auto-fit ููุนูุฏ ุถุจุท ุงูุฎุฑูุทุฉ ุชููุงุฆูุงู

### ๐ ุณููู Auto-Fit:
- ุจุนุฏ ุญุณุงุจ ุงููููุน ุงูุงุจุชุฏุงุฆู
- ุงูุฎุฑูุทุฉ ุชุนูู auto-fit ูุชุดูู ุฌููุน ุงูุฑุญูุงุช
- ูุฐุง ูุถูู ุฑุคูุฉ ุฌููุน ุงูุฑุญูุงุช ุฏูุนุฉ ูุงุญุฏุฉ

---

## ๐จ ุชุฎุตูุต ูุชูุฏู

### ุชุบููุฑ ุงุณุชุฑุงุชูุฌูุฉ ุงููููุน:

ุฅุฐุง ุฃุฑุฏุช ุงุณุชุฑุงุชูุฌูุฉ ูุฎุชููุฉุ ููููู ุชุนุฏูู `_calculateSmartInitialLocation`:

```dart
// ูุซุงู: ุงุณุชุฎุฏุงู ุฃูู ุฑุญูุฉ ูุดุทุฉ ุจุฏูุงู ูู ุงููุฑูุฒ
MapLocation _calculateSmartInitialLocation(List<Trip> trips) {
  final tripsWithLocation = trips
      .where((t) => _isValidLatLng(t.currentLatitude, t.currentLongitude))
      .toList();

  if (tripsWithLocation.isEmpty) {
    return CompanyConfig.defaultLocation;
  }

  // ุงุณุชุฎุฏู ุฃูู ุฑุญูุฉ
  final firstTrip = tripsWithLocation.first;
  return MapLocation(
    latitude: firstTrip.currentLatitude!,
    longitude: firstTrip.currentLongitude!,
  );
}
```

### ุฅุถุงูุฉ ููุงูุน ูุชุนุฏุฏุฉ ููุดุฑูุฉ:

```dart
// ูู company_config.dart
class CompanyConfig {
  static const branchLocations = {
    'ุทูุฌุฉ': MapLocation(latitude: 35.7595, longitude: -5.8340),
    'ุงูุฑุจุงุท': MapLocation(latitude: 33.9716, longitude: -6.8498),
    'ุงูุฏุงุฑ ุงูุจูุถุงุก': MapLocation(latitude: 33.5731, longitude: -7.5898),
  };

  static const currentBranch = 'ุทูุฌุฉ';
  
  static MapLocation get defaultLocation => 
    branchLocations[currentBranch]!;
}
```

---

## ๐ ุญู ุงููุดุงูู

### ุงููุดููุฉ: ุงูุฎุฑูุทุฉ ุชุจุฏุฃ ูู ูููุน ุฎุงุทุฆ

**ุงูุญู:**
1. ุชุญูู ูู ุฅุญุฏุงุซูุงุช ุงูุดุฑูุฉ ูู `company_config.dart`
2. ุชุญูู ูู ุตูุงุญูุฉ ุฅุญุฏุงุซูุงุช ุงูุฑุญูุงุช
3. ุฑุงุฌุน ุงูู debug logs

### ุงููุดููุฉ: ุงูุฎุฑูุทุฉ ูุง ุชุนุฑุถ ุงูุฑุญูุงุช

**ุงูุญู:**
1. ุชุฃูุฏ ูู ุฃู ุงูุฑุญูุงุช ููุง ุฅุญุฏุงุซูุงุช ุตุงูุญุฉ
2. ุชุญูู ูู `_isValidLatLng`
3. ุชุฃูุฏ ูู ุนูู auto-fit

---

**โ ุงูููุฒุฉ ุฌุงูุฒุฉ ููุงุณุชุฎุฏุงู!**

ุชูุชุน ุจุชุฌุฑุจุฉ ุฎุฑูุทุฉ ุฐููุฉ ุชุจุฏุฃ ุฏุงุฆูุงู ูู ุงููููุน ุงูุตุญูุญ! ๐
