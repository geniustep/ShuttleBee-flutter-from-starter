# ุฅุตูุงุญ ูุดููุฉ ุงูุชููู ูู ShuttleBee

## ๐ ุงููุดููุฉ

ุงูุชุทุจูู ูุงู ูุณุชูุฑ ูู ุงูุนูู ุญุชู ุนูุฏูุง ูุง ููุฌุฏ ุชููู ุตุงูุญุ ููู ููู ููุฌู ุงููุณุชุฎุฏู ุชููุงุฆูุงู ุฅูู ุตูุญุฉ ุชุณุฌูู ุงูุฏุฎูู.

## โ ุงูุญู ุงููุทุจู

### 1. ุชุญุณูู ูุนุงูุฌุฉ ุญุงูุงุช ุงูุชููู ูู `SplashScreen`

**ุงูููู**: `lib/features/splash/presentation/screens/splash_screen.dart`

**ุงูุชุนุฏูู**: ุฅุถุงูุฉ ูุญุต ุฌุฏูุฏ ููุชุนุงูู ูุน ุญุงูุฉ `invalidToken`:

```dart
// Check if token is invalid (needs re-login)
if (auth.error != null && auth.error!.contains('ุงูุชูุช ุตูุงุญูุฉ ุงูุฌูุณุฉ')) {
  // Invalid token detected - clear and go to login
  _updateStatus('ูุฑุฌู ุชุณุฌูู ุงูุฏุฎูู ูุฌุฏุฏุงู');
  await Future.delayed(const Duration(milliseconds: 500));
  _navigateToLogin();
  return;
}
```

**ุงููุงุฆุฏุฉ**:
- ููุญุต ุฅุฐุง ูุงู ููุงู ุฎุทุฃ ูุดูุฑ ุฅูู ุงูุชูุงุก ุตูุงุญูุฉ ุงูุฌูุณุฉ
- ูุนุฑุถ ุฑุณุงูุฉ ูุงุถุญุฉ ูููุณุชุฎุฏู
- ููุฌู ุงููุณุชุฎุฏู ููุฑุงู ุฅูู ุตูุญุฉ ุชุณุฌูู ุงูุฏุฎูู

---

### 2. ุชุญุณูู ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก ูู `AuthProvider`

**ุงูููู**: `lib/features/auth/presentation/providers/auth_provider.dart`

**ุงูุชุนุฏูู**: ุฅุถุงูุฉ ูุนุงูุฌุฉ ุงุณุชุซูุงุกุงุช ุนูุฏ ุงูุชุญูู ูู ุตูุงุญูุฉ ุงูุชููู:

```dart
try {
  final tokenValidation = await BridgeCore.instance.auth.validateToken();
  final isValidTenantToken = tokenValidation['isValid'] == true;
  if (!isValidTenantToken) {
    print('โ๏ธ [_checkAuthStatus] Token is NOT a valid tenant token!');
    // ... clear session and logout
    state = AsyncValue.data(AuthState.invalidToken());
    return;
  }
  print('โ [_checkAuthStatus] Token is a valid tenant token');
} catch (e) {
  // Token validation failed - likely invalid or expired
  print('โ [_checkAuthStatus] Token validation failed: $e');
  await _clearSession();
  await BridgeCore.instance.auth.logout();
  state = AsyncValue.data(AuthState.invalidToken());
  return;
}
```

**ุงููุงุฆุฏุฉ**:
- ููุชูุท ุฃู ุฃุฎุทุงุก ุฃุซูุงุก ุงูุชุญูู ูู ุงูุชููู
- ูุถูู ุชูุธูู ุงูุฌูุณุฉ ุนูุฏ ูุดู ุงูุชุญูู
- ูุญุฏุซ ุญุงูุฉ ุงููุตุงุฏูุฉ ุฅูู `invalidToken` ูุฅุจูุงุบ `SplashScreen`

---

## ๐ ุชุฏูู ุงููุตุงุฏูุฉ ุจุนุฏ ุงูุฅุตูุงุญ

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ      ุจุฏุก ุงูุชุทุจูู (main.dart)           โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                 โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ      ุชููุฆุฉ BridgeCore (bootstrap)      โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                 โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ         SplashScreen ูุธูุฑ              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                 โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  AuthProvider ููุญุต ุญุงูุฉ ุงูุชููู         โ
โ  (_checkAuthStatus ูู auth_provider)   โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                 โ
         โโโโโโโโโโโโโโโโโ
         โ ูู ุงูุชููู ููุฌูุฏุ โ
         โโโโโโโโโโโโโโโโโ
         /              \
       ูุนู              ูุง
        โ                โ
โโโโโโโโโโโโโโโโ   โโโโโโโโโโโโโโโโ
โ ุงูุชุญูู ูู    โ   โ ุงูุฐูุงุจ ุฅูู   โ
โ ุตูุงุญูุฉ ุงูุชูููโ   โ ุตูุญุฉ ุงูุฏุฎูู  โ
โโโโโโโโโโโโโโโโ   โโโโโโโโโโโโโโโโ
        โ
  โโโโโโโโโโโโโโโโโโโ
  โ ูู ุงูุชููู ุตุงูุญุ  โ
  โโโโโโโโโโโโโโโโโโโ
    /            \
  ูุนู            ูุง
   โ              โ
โโโโโโโโโโ   โโโโโโโโโโโโโโโโ
โ ุงูุฐูุงุจ โ   โ ูุณุญ ุงูุฌูุณุฉ   โ
โ ููุฑุฆูุณูุฉโ   โ ูุงูุฐูุงุจ ุฅูู  โ
โ        โ   โ ุตูุญุฉ ุงูุฏุฎูู  โ
โโโโโโโโโโ   โโโโโโโโโโโโโโโโ
```

---

## ๐ ุญุงูุงุช ุงูุชููู ุงููุฏุนููุฉ

| ุงูุญุงูุฉ | ุงููุตู | ุงูุณููู |
|-------|-------|--------|
| **TokenState.valid** | ุงูุชููู ุตุงูุญ ูุฌุงูุฒ | ุงูุฐูุงุจ ููุฑุฆูุณูุฉ ูุจุงุดุฑุฉ |
| **TokenState.needsRefresh** | ุงูุชููู ููุชูู ููู ูููู ุชุฌุฏูุฏู | ูุญุงููุฉ ุงูุชุฌุฏูุฏ ุฃู ุงููุถุน ุงูุฃูููุงูู |
| **TokenState.expired** | ูู ุงูุชูููุงุช ููุชููุฉ | ูุณุญ ุงูุฌูุณุฉ ูุงูุฐูุงุจ ูุชุณุฌูู ุงูุฏุฎูู |
| **TokenState.none** | ูุง ุชูุฌุฏ ุชูููุงุช | ูุญุต ุงูุจูุงูุงุช ุงููุญููุฉ ุฃู ุงูุฐูุงุจ ููุฏุฎูู |
| **InvalidToken Error** | ุงูุชููู ููุฌูุฏ ููู ุบูุฑ ุตุงูุญ | ูุณุญ ุงูุฌูุณุฉ ูุงูุฐูุงุจ ูุชุณุฌูู ุงูุฏุฎูู |

---

## ๐งช ุงุฎุชุจุงุฑ ุงูุฅุตูุงุญ

### ุงูุณููุงุฑูู 1: ูุณุชุฎุฏู ุฌุฏูุฏ (ุจุฏูู ุชููู)
```
1. ุงูุชุญ ุงูุชุทุจูู ูุฃูู ูุฑุฉ
2. ุงููุชูุฌุฉ ุงููุชููุนุฉ: ูุธูุฑ SplashScreen ุซู ูุฐูุจ ูุตูุญุฉ ุงูุฏุฎูู
```

### ุงูุณููุงุฑูู 2: ุชููู ููุชูู ุงูุตูุงุญูุฉ
```
1. ุชููู ุงููุตูู ููุชูู ููู refresh token ุตุงูุญ
2. ุงููุชูุฌุฉ ุงููุชููุนุฉ: ูุชู ุชุญุฏูุซ ุงูุชููู ุชููุงุฆูุงู ูุงูุฐูุงุจ ููุฑุฆูุณูุฉ
```

### ุงูุณููุงุฑูู 3: ุชููู ุบูุฑ ุตุงูุญ
```
1. ุงูุชููู ููุฌูุฏ ููู ุบูุฑ ุตุงูุญ (ููุณ tenant token)
2. ุงููุชูุฌุฉ ุงููุชููุนุฉ: ูุณุญ ุงูุฌูุณุฉ ูุงูุฐูุงุจ ูุตูุญุฉ ุงูุฏุฎูู
```

### ุงูุณููุงุฑูู 4: ูุถุน ุฃูููุงูู
```
1. ุงููุณุชุฎุฏู ูุณุฌู ุฏุฎูู ููู ูุง ููุฌุฏ ุฅูุชุฑูุช
2. ุงููุชูุฌุฉ ุงููุชููุนุฉ: ุงูุณูุงุญ ุจุงูุฏุฎูู ุจูุถุน ุฃูููุงูู ูุน ุงูุจูุงูุงุช ุงููุญููุฉ
```

---

## ๐ ุงููููุงุช ุงููุนุฏูุฉ

1. **`lib/features/splash/presentation/screens/splash_screen.dart`**
   - ุงูุณุทูุฑ: 91-98 (ุฅุถุงูุฉ ูุญุต ุญุงูุฉ invalidToken)

2. **`lib/features/auth/presentation/providers/auth_provider.dart`**
   - ุงูุณุทูุฑ: 86-113 (ุฅุถุงูุฉ try-catch ููุชุนุงูู ูุน ุฃุฎุทุงุก ุงูุชุญูู)

---

## ๐ก ูุตุงุฆุญ ูููุทูุฑูู

### 1. ูุงุฎุชุจุงุฑ ุณููุงุฑูููุงุช ูุฎุชููุฉ:

```dart
// ูู auth_provider.dart - ููุงุฎุชุจุงุฑ ููุท
// ูู ุจุงูุชุนููู ุนูู ุงูุชุญูู ูู ุตูุงุญูุฉ ุงูุชููู:
/*
if (tokenState == TokenState.valid || tokenState == TokenState.needsRefresh) {
  try {
    // ... token validation code
  } catch (e) {
    // ... error handling
  }
}
*/
```

### 2. ููุณุญ ุงูุชููู ูุฏููุงู:

```dart
// ูู ุฃู ููุงู ูู ุงูุชุทุจูู
await BridgeCore.instance.auth.logout();
```

### 3. ููุญุต ุญุงูุฉ ุงูุชููู ุงูุญุงููุฉ:

```dart
final tokenState = await BridgeCore.instance.auth.authState;
print('Token State: $tokenState');

final tokenInfo = await BridgeCore.instance.auth.getTokenInfo();
print('Token Info: $tokenInfo');
```

---

## ๐ ุงูุฎุทูุงุช ุงูุชุงููุฉ (ุงุฎุชูุงุฑู)

1. **ุฅุถุงูุฉ Biometric Authentication**
   - ุงุณุชุฎุฏุงู `local_auth` package
   - ุญูุธ ุจูุงูุงุช ุงูุงุนุชูุงุฏ ุจุดูู ุขูู
   - ุงูุชูุงูู ูุน BridgeCore

2. **ุฅุถุงูุฉ Remember Me ูุชูุฏู**
   - ุญูุธ ุขุฎุฑ ุจุฑูุฏ ุฅููุชุฑููู ูุณุชุฎุฏู
   - ุฎูุงุฑ ุชุณุฌูู ุฏุฎูู ุณุฑูุน
   - ุฅุฏุงุฑุฉ ุฌูุณุงุช ูุชุนุฏุฏุฉ

3. **ุชุญุณูู ุชุฌุฑุจุฉ ุงููุณุชุฎุฏู**
   - ุฑุณุงุฆู ุฎุทุฃ ุฃูุซุฑ ูุถูุญุงู ุจุงูุนุฑุจูุฉ
   - ุฃููููุดู ุณูุณ ุนูุฏ ุงูุงูุชูุงู
   - ุฏุนู Dark Mode ูู ุตูุญุฉ ุงูุฏุฎูู

---

## ๐ ุงูุฏุนู

ุฅุฐุง ูุงุฌูุช ุฃู ูุดุงูู:

1. ุชุญูู ูู logs ูู Console (ุงูุจุญุซ ุนู emoji: ๐ ๐ โ๏ธ โ โ)
2. ุชุฃูุฏ ูู ุฃู `.env` ูุญุชูู ุนูู `ODOO_URL` ุงูุตุญูุญ
3. ุชุญูู ูู ุฃู BridgeCore SDK ูุญุฏุซ ุฅูู ุขุฎุฑ ุฅุตุฏุงุฑ

---

## โจ ุงูุฎูุงุตุฉ

ุงูุชุนุฏููุงุช ุงููุทุจูุฉ ุชุถูู:

โ **ุงูุชุญูู ุงูุตุญูุญ ูู ุญุงูุฉ ุงูุชููู** ุนูุฏ ุจุฏุก ุงูุชุทุจูู
โ **ุงูุชูุฌูู ุงูุชููุงุฆู ูุตูุญุฉ ุงูุฏุฎูู** ุนูุฏ ุนุฏู ูุฌูุฏ ุชููู ุตุงูุญ
โ **ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก ุจุดูู ุฃูุถู** ุนูุฏ ูุดู ุงูุชุญูู ูู ุงูุชููู
โ **ุฏุนู ุงููุถุน ุงูุฃูููุงูู** ููุณุงุฆููู ูู ShuttleBee
โ **ุชุฌุฑุจุฉ ูุณุชุฎุฏู ูุญุณูุฉ** ูุน ุฑุณุงุฆู ูุงุถุญุฉ ุจุงูุนุฑุจูุฉ

---

ุชู ุงูุชุญุฏูุซ: 2025-12-21
