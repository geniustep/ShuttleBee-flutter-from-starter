# ุงุฎุชุจุงุฑ ุชุฏูู ุงููุตุงุฏูุฉ - ShuttleBee

## ๐งช ุณููุงุฑูููุงุช ุงูุงุฎุชุจุงุฑ

### 1๏ธโฃ ูุณุชุฎุฏู ุฌุฏูุฏ (ุจุฏูู ุชููู)

**ุงูุฎุทูุงุช:**
1. ุงุญุฐู ุจูุงูุงุช ุงูุชุทุจูู ูู ุงูุฌูุงุฒ ุฃู ุงููุญุงูู
   ```bash
   flutter clean
   flutter pub get
   ```
2. ุดุบู ุงูุชุทุจูู
   ```bash
   flutter run
   ```

**ุงููุชูุฌุฉ ุงููุชููุนุฉ:**
- โ ูุธูุฑ `SplashScreen` ูุน ุดุนุงุฑ ุงูุชุทุจูู
- โ ุฑุณุงูุฉ "ุฌุงุฑู ุงูุชุญููู..."
- โ ุจุนุฏ 2 ุซุงููุฉุ ููุชูู **ุชููุงุฆูุงู** ุฅูู ุตูุญุฉ ุชุณุฌูู ุงูุฏุฎูู
- โ ุตูุญุฉ ุงูุฏุฎูู ุชุธูุฑ ุญููู ุงูุจุฑูุฏ ุงูุฅููุชุฑููู ููููุฉ ุงููุฑูุฑ

---

### 2๏ธโฃ ุชุณุฌูู ุฏุฎูู ูุงุฌุญ

**ุงูุฎุทูุงุช:**
1. ูู ุตูุญุฉ ุงูุฏุฎููุ ุฃุฏุฎู:
   - ุงูุจุฑูุฏ ุงูุฅููุชุฑููู: (ุญุณุจ ุจูุงูุงุช ุงูุงุฎุชุจุงุฑ)
   - ูููุฉ ุงููุฑูุฑ: (ุญุณุจ ุจูุงูุงุช ุงูุงุฎุชุจุงุฑ)
2. ุงุถุบุท ุนูู ุฒุฑ "ุชุณุฌูู ุงูุฏุฎูู"

**ุงููุชูุฌุฉ ุงููุชููุนุฉ:**
- โ ูุธูุฑ ูุคุดุฑ ุงูุชุญููู ุนูู ุงูุฒุฑ
- โ ูุชู ุญูุธ ุงูุชููู ูู ุงูุชุฎุฒูู ุงูุขูู
- โ ููุชูู ุงููุณุชุฎุฏู ุฅูู ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ ุญุณุจ ุงูุฏูุฑ (Driver/Guardian/Dispatcher)
- โ ูุง ุชูุฌุฏ ุฑุณุงุฆู ุฎุทุฃ

---

### 3๏ธโฃ ุฅุนุงุฏุฉ ูุชุญ ุงูุชุทุจูู (ูุน ุชููู ุตุงูุญ)

**ุงูุฎุทูุงุช:**
1. ุจุนุฏ ุชุณุฌูู ุงูุฏุฎูู ุงููุงุฌุญุ ุงุบูู ุงูุชุทุจูู
2. ุงูุชุญ ุงูุชุทุจูู ูุฑุฉ ุฃุฎุฑู

**ุงููุชูุฌุฉ ุงููุชููุนุฉ:**
- โ ูุธูุฑ `SplashScreen`
- โ ุฑุณุงูุฉ "ูุฑุญุจุงู [ุงุณู ุงููุณุชุฎุฏู]"
- โ ููุชูู **ูุจุงุดุฑุฉู** ุฅูู ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ **ุจุฏูู** ุงููุฑูุฑ ุจุตูุญุฉ ุงูุฏุฎูู
- โ ูุง ุชูุฌุฏ ุญุงุฌุฉ ูุฅุฏุฎุงู ุงูุจูุงูุงุช ูุฑุฉ ุฃุฎุฑู

---

### 4๏ธโฃ ุชููู ููุชูู ุงูุตูุงุญูุฉ (ูุน refresh token ุตุงูุญ)

**ุงูุฎุทูุงุช:**
1. ุงูุชุธุฑ ุญุชู ููุชูู ุชููู ุงููุตูู (ุนุงุฏุฉ ุณุงุนุฉ ูุงุญุฏุฉ)
   - ุฃู ููููู ุชุนุฏูู ุงูุชููู ูุฏููุงู ูู ุงูุชุฎุฒูู ูุงุฎุชุจุงุฑ ุฃุณุฑุน
2. ุงูุชุญ ุงูุชุทุจูู

**ุงููุชูุฌุฉ ุงููุชููุนุฉ:**
- โ ูุธูุฑ `SplashScreen`
- โ ุฑุณุงูุฉ "ุฌุงุฑู ุชุญุฏูุซ ุงูุฌูุณุฉ..."
- โ ูุชู ุชุญุฏูุซ ุงูุชููู **ุชููุงุฆูุงู** ูู ุงูุฎูููุฉ
- โ ููุชูู ุฅูู ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ ุจูุฌุงุญ
- โ ูุง ุชูุฌุฏ ุญุงุฌุฉ ูุฅุนุงุฏุฉ ุชุณุฌูู ุงูุฏุฎูู

---

### 5๏ธโฃ ูู ุงูุชูููุงุช ููุชููุฉ ุงูุตูุงุญูุฉ

**ุงูุฎุทูุงุช:**
1. ุงูุชุธุฑ ุญุชู ููุชูู refresh token (ุนุงุฏุฉ 30 ููู)
2. ุงูุชุญ ุงูุชุทุจูู

**ุงููุชูุฌุฉ ุงููุชููุนุฉ:**
- โ ูุธูุฑ `SplashScreen`
- โ ุฑุณุงูุฉ "ุงูุชูุช ุตูุงุญูุฉ ุงูุฌูุณุฉ"
- โ ูุชู ูุณุญ ุงูุฌูุณุฉ ุชููุงุฆูุงู
- โ ููุชูู ุฅูู ุตูุญุฉ ุชุณุฌูู ุงูุฏุฎูู
- โ ูุชุทูุจ ุฅุฏุฎุงู ุงูุจูุงูุงุช ูุฑุฉ ุฃุฎุฑู

---

### 6๏ธโฃ ุชููู ุบูุฑ ุตุงูุญ (Invalid Token)

**ุงูุฎุทูุงุช:**
1. ูู ุจุชุนุฏูู ุงูุชููู ุงููุญููุธ ูุฏููุงู ููููู ุบูุฑ ุตุงูุญ
2. ุงูุชุญ ุงูุชุทุจูู

**ุงููุชูุฌุฉ ุงููุชููุนุฉ:**
- โ ูุธูุฑ `SplashScreen`
- โ ุฑุณุงูุฉ "ูุฑุฌู ุชุณุฌูู ุงูุฏุฎูู ูุฌุฏุฏุงู"
- โ ูุชู ูุณุญ ุงูุฌูุณุฉ ูุงูุชููู
- โ ููุชูู ุฅูู ุตูุญุฉ ุชุณุฌูู ุงูุฏุฎูู
- โ Console ูุธูุฑ: `โ๏ธ [_checkAuthStatus] Token is NOT a valid tenant token!`

---

### 7๏ธโฃ ูุถุน ุฃูููุงูู (ูุน ุจูุงูุงุช ูุญููุฉ)

**ุงูุฎุทูุงุช:**
1. ุณุฌู ุฏุฎูู ุจูุฌุงุญ
2. ุงูุตู ุงูุฅูุชุฑูุช (Airplane Mode)
3. ุงุบูู ูุงูุชุญ ุงูุชุทุจูู

**ุงููุชูุฌุฉ ุงููุชููุนุฉ:**
- โ ูุธูุฑ `SplashScreen`
- โ ุฑุณุงูุฉ "ูุถุน ุจุฏูู ุงุชุตุงู"
- โ SnackBar: "ุฃูุช ูู ูุถุน ุจุฏูู ุงุชุตุงู. ุจุนุถ ุงูููุฒุงุช ูุฏ ูุง ุชุนูู."
- โ ููุชูู ุฅูู ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ ูุน ุงูุจูุงูุงุช ุงููุญููุธุฉ ูุญููุงู
- โ ูููู ุชุตูุญ ุงูุจูุงูุงุช ุงููุฎุฒูุฉ ูุณุจูุงู

---

### 8๏ธโฃ ุชุณุฌูู ุฎุฑูุฌ

**ุงูุฎุทูุงุช:**
1. ูู ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉุ ุงุถุบุท ุนูู ุฒุฑ ุชุณุฌูู ุงูุฎุฑูุฌ
2. ุชุฃูุฏ ูู ุฑุณุงูุฉ ุงูุชุฃููุฏ
3. ุงุถุบุท "ุชุณุฌูู ุงูุฎุฑูุฌ"

**ุงููุชูุฌุฉ ุงููุชููุนุฉ:**
- โ ูุชู ูุณุญ ุฌููุน ุงูุชูููุงุช
- โ ูุชู ูุณุญ ุงูุฌูุณุฉ
- โ ููุชูู ุฅูู ุตูุญุฉ ุชุณุฌูู ุงูุฏุฎูู
- โ ุฅุนุงุฏุฉ ูุชุญ ุงูุชุทุจูู ูุฐูุจ ูุตูุญุฉ ุงูุฏุฎูู

---

## ๐ ูุญุต Logs

ุฃุซูุงุก ุงูุงุฎุชุจุงุฑุ ุฑุงูุจ Console ููุฑุณุงุฆู ุงูุชุงููุฉ:

### โ ุฑุณุงุฆู ุงููุฌุงุญ:
```
๐ [_checkAuthStatus] Starting smart auth check...
๐ [_checkAuthStatus] Network status: online
๐ [_checkAuthStatus] BridgeCore auth state: TokenAuthState.authenticated
โ [_checkAuthStatus] Token is a valid tenant token
โ [_restoreSession] Auth state set (tokenState: TokenState.valid)
๐ [SplashScreen] Navigating to: /driver/home (role: driver)
```

### โ๏ธ ุฑุณุงุฆู ุงูุชุญุฐูุฑ:
```
โ๏ธ [_checkAuthStatus] Token is NOT a valid tenant token!
๐ [_checkAuthStatus] Token details: {...}
๐ [_checkAuthStatus] Clearing invalid token and requiring re-login...
```

### โ ุฑุณุงุฆู ุงูุฎุทุฃ:
```
โ [_checkAuthStatus] Token validation failed: ...
โ [_checkAuthStatus] Error: ...
```

---

## ๐๏ธ ุฃุฏูุงุช ุงุฎุชุจุงุฑ ูููุฏุฉ

### 1. ูุณุญ ุงูุชููู ูุฏููุงู (ููุงุฎุชุจุงุฑ)

ุฃุถู ูุฐุง ุงูููุฏ ูู ุฃู ููุงู ูู ุงูุชุทุจูู:

```dart
// ูู Developer Options ุฃู Settings
ElevatedButton(
  onPressed: () async {
    await BridgeCore.instance.auth.logout();
    ScaffoldMessenger.of(context).showSnackBar(
      SnackBar(content: Text('ุชู ูุณุญ ุงูุชููู')),
    );
  },
  child: Text('ูุณุญ ุงูุชููู (ุงุฎุชุจุงุฑ)'),
)
```

### 2. ุนุฑุถ ูุนูููุงุช ุงูุชููู

```dart
// ูู Developer Options ุฃู Settings
ElevatedButton(
  onPressed: () async {
    final tokenInfo = await BridgeCore.instance.auth.getTokenInfo();
    final authState = await BridgeCore.instance.auth.authState;

    print('Token Info: $tokenInfo');
    print('Auth State: $authState');

    showDialog(
      context: context,
      builder: (context) => AlertDialog(
        title: Text('ูุนูููุงุช ุงูุชููู'),
        content: Text(
          'State: $authState\n'
          'Has Tokens: ${tokenInfo['hasTokens']}\n'
          'Access Expired: ${tokenInfo['isAccessExpired']}\n'
          'Refresh Expired: ${tokenInfo['isRefreshExpired']}\n'
          'Access Expires In: ${tokenInfo['accessExpiresIn']} min\n'
          'Refresh Expires In: ${tokenInfo['refreshExpiresIn']} days',
        ),
        actions: [
          TextButton(
            onPressed: () => Navigator.pop(context),
            child: Text('ุฅุบูุงู'),
          ),
        ],
      ),
    );
  },
  child: Text('ุนุฑุถ ูุนูููุงุช ุงูุชููู'),
)
```

### 3. ูุญุงูุงุฉ ุงููุถุน ุงูุฃูููุงูู

```dart
// ูู Developer Options
ElevatedButton(
  onPressed: () {
    // ูู ุจุชุจุฏูู ุญุงูุฉ ุงูุดุจูุฉ
    final currentState = ref.read(isOnlineStateProvider);
    ref.read(isOnlineStateProvider.notifier).state = !currentState;

    ScaffoldMessenger.of(context).showSnackBar(
      SnackBar(
        content: Text(
          currentState ? 'ุชู ุงูุชุจุฏูู ุฅูู ูุถุน ุฃูููุงูู' : 'ุชู ุงูุชุจุฏูู ุฅูู ูุถุน ุฃูููุงูู',
        ),
      ),
    );
  },
  child: Text('ุชุจุฏูู ุงููุถุน ุงูุฃูููุงูู'),
)
```

---

## โ Checklist ุงูุงุฎุชุจุงุฑ ุงูุดุงูู

- [ ] ูุณุชุฎุฏู ุฌุฏูุฏ โ ุตูุญุฉ ุงูุฏุฎูู
- [ ] ุชุณุฌูู ุฏุฎูู ูุงุฌุญ โ ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ
- [ ] ุฅุนุงุฏุฉ ูุชุญ ุงูุชุทุจูู โ ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ ูุจุงุดุฑุฉ
- [ ] ุชููู ููุชูู + refresh ุตุงูุญ โ ุชุญุฏูุซ ุชููุงุฆู
- [ ] ูู ุงูุชูููุงุช ููุชููุฉ โ ุตูุญุฉ ุงูุฏุฎูู
- [ ] ุชููู ุบูุฑ ุตุงูุญ โ ุตูุญุฉ ุงูุฏุฎูู
- [ ] ูุถุน ุฃูููุงูู โ ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ ูุน ุจูุงูุงุช ูุญููุฉ
- [ ] ุชุณุฌูู ุฎุฑูุฌ โ ุตูุญุฉ ุงูุฏุฎูู

---

## ๐ฑ ุงุฎุชุจุงุฑ ุนูู ุฃุฌูุฒุฉ ูุฎุชููุฉ

### Android
```bash
flutter run -d android
```

### iOS
```bash
flutter run -d ios
```

### Web (ููุงุฎุชุจุงุฑ ุงูุณุฑูุน)
```bash
flutter run -d chrome
```

---

## ๐ ุญู ุงููุดุงูู ุงูุดุงุฆุนุฉ

### ุงููุดููุฉ: ุงูุชุทุจูู ูุง ูุฐูุจ ูุตูุญุฉ ุงูุฏุฎูู
**ุงูุญู:**
1. ุชุญูู ูู ุฃู `EnvConfig.odooUrl` ุตุญูุญ ูู `.env`
2. ุชุญูู ูู ุงูู logs ูู Console
3. ุงูุณุญ ุจูุงูุงุช ุงูุชุทุจูู ูุฃุนุฏ ุงูุชุดุบูู

### ุงููุดููุฉ: ุงูุชููู ูุง ูุชุญุฏุซ ุชููุงุฆูุงู
**ุงูุญู:**
1. ุชุญูู ูู ุฃู ุงูุฅูุชุฑูุช ูุชุตู
2. ุชุญูู ูู ุตูุงุญูุฉ `refresh_token`
3. ุฑุงุฌุน ุงูู logs: `๐ [_checkAuthStatus] Token needs refresh`

### ุงููุดููุฉ: ุฎุทุฃ ุนูุฏ ุงูุชุญูู ูู ุงูุชููู
**ุงูุญู:**
1. ุชุญูู ูู ุฃู BridgeCore SDK ูุญุฏุซ
2. ุชุฃูุฏ ูู ุฃู ุงูู API ูุชุงุญ
3. ุฑุงุฌุน ุงูู logs: `โ [_checkAuthStatus] Token validation failed`

---

ุชู ุงูุชุญุฏูุซ: 2025-12-21
